import tkinter as tk
from tkinter import filedialog, messagebox
import ifcopenshell

# Definition der Widgets und GUI Elemente
def create_widgets(app):
    # Upload-Felder für Armierung alt, Armierung neu und Betongehalt
    app.upload_label_old_reinforcement = tk.Label(app.root, text="Armierung alt hochladen")
    app.upload_label_old_reinforcement.pack(pady=5)
    app.upload_button_old_reinforcement = tk.Button(app.root, text="Dateien auswählen", command=lambda: load_file(app, 'old_reinforcement'))
    app.upload_button_old_reinforcement.pack(pady=5)

    app.upload_label_new_reinforcement = tk.Label(app.root, text="Armierung neu hochladen")
    app.upload_label_new_reinforcement.pack(pady=5)
    app.upload_button_new_reinforcement = tk.Button(app.root, text="Dateien auswählen", command=lambda: load_file(app, 'new_reinforcement'))
    app.upload_button_new_reinforcement.pack(pady=5)

    app.upload_label_concrete = tk.Label(app.root, text="Betongehalt hochladen")
    app.upload_label_concrete.pack(pady=5)
    app.upload_button_concrete = tk.Button(app.root, text="Dateien auswählen", command=lambda: load_file(app, 'concrete'))
    app.upload_button_concrete.pack(pady=5)

    # Button zum Anzeigen der extrahierten Daten
    app.extract_button = tk.Button(app.root, text="Extrahiere Daten", command=lambda: extract_data(app))
    app.extract_button.pack(pady=10)

# Funktion zum Laden der Dateien
def load_file(app, category):
    file_path = filedialog.askopenfilename(filetypes=[("IFC files", "*.ifc")])
    if file_path:
        if category == 'old_reinforcement':
            app.old_reinforcement_file = file_path
        elif category == 'new_reinforcement':
            app.new_reinforcement_file = file_path
        elif category == 'concrete':
            app.concrete_file = file_path
    else:
        messagebox.showerror("Fehler", "Keine Datei ausgewählt")

# Funktion zum Extrahieren der Daten
def extract_data(app):
    if hasattr(app, 'old_reinforcement_file') and hasattr(app, 'new_reinforcement_file') and hasattr(app, 'concrete_file'):
        # Extraktion der Betonmenge
        concrete_model = ifcopenshell.open(app.concrete_file)
        concrete_volume = sum([element.Volume for element in concrete_model.by_type('IfcSlab') if hasattr(element, 'Volume')])

        # Extraktion der Armierungsmengen
        old_reinforcement_model = ifcopenshell.open(app.old_reinforcement_file)
        new_reinforcement_model = ifcopenshell.open(app.new_reinforcement_file)

        old_reinforcement_count = len(old_reinforcement_model.by_type('IfcReinforcingBar'))
        new_reinforcement_count = len(new_reinforcement_model.by_type('IfcReinforcingBar'))

        # Anzeige der Ergebnisse
        messagebox.showinfo("Daten extrahiert", f"Betonmenge: {concrete_volume} m^3\nArmierung alt: {old_reinforcement_count} Elemente\nArmierung neu: {new_reinforcement_count} Elemente")
    else:
        messagebox.showerror("Fehler", "Bitte laden Sie zuerst alle benötigten Dateien hoch")

# Hauptanwendungsklasse
def main():
    root = tk.Tk()
    root.title("IFC Datenmanager")
    app = tk.Frame(root)
    app.root = root
    create_widgets(app)
    root.mainloop()

if __name__ == "__main__":
    main()
